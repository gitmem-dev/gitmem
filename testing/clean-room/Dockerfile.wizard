# GitMem Wizard Test Container
#
# Like the main Dockerfile but STOPS before running init.
# You run the wizard yourself inside the container.
#
# Build:
#   npm run build && npm pack --pack-destination testing/clean-room/
#   docker build -t gitmem-wizard -f testing/clean-room/Dockerfile.wizard testing/clean-room/
#
# Run:
#   docker run -it --rm -e ANTHROPIC_API_KEY=$ANTHROPIC_API_KEY gitmem-wizard

FROM node:20-slim

# System dependencies
RUN apt-get update && apt-get install -y --no-install-recommends \
    git \
    curl \
    jq \
  && rm -rf /var/lib/apt/lists/*

# Install Claude CLI
RUN npm install -g @anthropic-ai/claude-code

# Create non-root developer user
RUN useradd -m -s /bin/bash developer
USER developer
WORKDIR /home/developer/my-project

# Init a git repo (gitmem expects one)
RUN git init && git config user.email "dev@test.local" && git config user.name "Test Dev"

# Install gitmem from tarball (but do NOT run init)
COPY --chown=developer:developer gitmem-mcp-*.tgz /tmp/
RUN npm init -y && npm install /tmp/gitmem-mcp-*.tgz

# Drop into bash â€” user runs wizard manually
CMD ["bash"]
